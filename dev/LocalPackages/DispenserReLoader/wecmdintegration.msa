######################################################
#
#   ReLoad: Fill chests, dispensers, and furnaces in one click!
#   This optional command provides integration into WorldEdit unbind commands.
#   If used with a ReLoad tool, the ReLoad tool will be unbinded instead.
#   version 1.1-tmc
#
######################################################


/none [$action] [$] = >>>
assign(@name, string(import('dispenserreloader.name')))
assign(@player, _reloader_getplayerID(player()))
if(player() == ~console,
#	msg(hi)
	die('The console cannot use a tool.')
)


assign(@index, null)
#Find the tool in the players hand. Don't use just a hand, sorry.
try(
	assign(@tool, pinv(@player[name], @index)[type])
,@fail,
	#ReLoad tool does not bind to Hand. Redirecting to WorldEdit.	
	run(/none)
	die()
)

assign(@isenabled, import(@name.'.player.'.@player[id].'.tool.id.'.@tool))

#Shortcut to /reloader managebind
if($action == 'undo',
	#check if tool has been previously bound
	if(import(@name.'.player.'.@player[id].'.tool.id.'.@tool.'.item') == null,
		die(color(c).'['.color(6).@name.color(c).'] '.color(7).'This tool was not previously bound. You need to use \'/reloader\' to setup this tool for use!')
	)
        #Enable
        export(@name.'.player.'.@player[id].'.tool.id.'.@tool, true)
	die(color(7).'['.color(6).@name.color(7).'] '.color(3).'ReLoad tool re-bound to your '.data_name(@tool).', utilizing previously used settings for this item.')	
)

#Check if ReLoad is bound to the tool, and unbind it if so. Otherwise redirect to WorldEdit to unbind a WE tool.
if(@isenabled == true,
        # Disable tool.
        export(@name.'.player.'.@player[id].'.tool.id.'.@tool, false)
        die(color(7).'['.color(6).@name.color(7).'] '.color(3).'Tool unbound from your '.data_name(@tool).'.')
,
	#ReLoad not enabled on this tool. Redirecting to WorldEdit.
	run(/none)
)
<<<
